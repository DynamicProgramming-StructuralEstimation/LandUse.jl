---
title: "urban growth and pop density"
author: "Florian Oswald"
date: "5/23/2020"
output:
  bookdown::html_document2: default
  bookdown::pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(LandUseR)
```

# The top 100 French Cities

In this doc (and our paper) we look at the biggest 100 French cities in 2016. We measure area and population for each city in 1975, 1990, 2000 and 2015 using GHSL data. The data come in a 250m x 250m raster of grid cells. Figure \@ref(fig:cities) is an example of built-up data for Paris:

```{r cities, fig.cap = "Paris built grids",echo = FALSE, fig.width=8, fig.height = 8}
cc = LandUseR:::cropcities()

par(mfrow=c(2,2))
for (yr in paste(LandUseR:::GHS_years())){
    raster::plot(cc[[yr]][[1]]$built,main = yr)
}
par(mfrow=c(1,1))
```

# Measuring area

1. For each city, get a bounding box in lat-long space (WGS84) that well contains entire city in last period. This is the box in the above plots.
1. We measure area from cells with built-up surface above a certain threshold (values are 0-100). I currently set 30. That means I consider cells where an algorithm classified 30% of the surface to be *built* up from satellite pictures to be *urban*. 
1. In the above plot, cut out all cells that are less than 30.
1. Count all remaining cells. Given each cell is a given size, that gives total area.
1. Similarly we deal with population: cut out the shape of the city based on the cutoff in point 2, then sum over all remaining cells.
1. Notice that, given cells are fixed size, that the population count is equivalent to density (it's number of people per 250 x 250 = 62500 $m^2$).

# Looking at most/median/least dense grid cells

* How does the densest / least dense group of cells evolve as the city grows?
* There is no notion of *location* here, just an ordering of cells according to density (it's true that the densest cells are in the center of towns).
* I basically wanted to know whether cities get more or less dense at various quantiles of their density distribution as the city changes area, or not. Did the same with population change as well.

```{r makeplots,echo = FALSE}
p = LandUseR:::plot_sat_densities()
```

## Change in Density vs Change in City Area (1975-2015)

```{r,message=FALSE, echo = FALSE}
p$growth
```

These plots show that at very non-dense quantiles as well as very dense quantiles (10 vs 90), as the city expands, those quantiles become less dense. For 50 and 90 quantile, the larger the city expansion, the more pronounced is the effect.

# Time Series for the 10 cities

How did each of those quantiles fare as the top 10 cities go through time?

## Time Series in population space

```{r}
p$pop
```



## Time Series in area space

```{r}
p$area
```
